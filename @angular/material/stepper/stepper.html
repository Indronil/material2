<div class="md-stepper"
     [class.md-stepper-horizontal]="orientation == 'horizontal'"
     [class.md-stepper-vertical]="orientation == 'vertical'"
     [class.md-stepper-alternative]="false">

    <div class="md-steps-wrapper" role="steplist"
         (keydown)="handleKeydown($event)">
        <div class="md-step-transient-feedback" [@fadeInOut]="" *ngIf="selectedStep.feedback && orientation=='horizontal'">
            <span [@fadeUpDown]="">{{selectedStep.feedbackMessage}}</span>
        </div>

        <div class="md-step-wrapper"
             role="step"
             md-step-label-wrapper
             *ngFor="let step of _steps; let i = index"
             [id]="_getStepId('label', i)"
             [tabIndex]="selectedIndex == i ? 0 : -1"
             [attr.aria-controls]="_getStepId('content', i)"
             [attr.aria-selected]="selectedIndex == i"
             [class.md-step-active]="selectedIndex == i || step.completed"
             [class.md-step-completed]="step.completed"
             [class.md-step-disabled]="_isStepDisabled(i)"
             (click)="selectStep(i)"
             [class.md-step-warning]="step.warning"
             [class.md-step-feedback]="step.feedback">


            <div class="md-step-item-wrapper">

                <div class="md-step-transient-feedback" [@fadeInOut]="" *ngIf="selectedStep.feedback && orientation=='vertical' && selectedIndex == i">
                    <span [@fadeUpDown]="">{{selectedStep.feedbackMessage}}</span>
                </div>

                <div class="md-step-icon">
                    <md-icon class="text-roboto" *ngIf="!step.completed && !step.warning">{{ i+1 }}</md-icon>
                    <md-icon *ngIf="!step.warning && step.completed">{{step._stepperIconLigature}}</md-icon>
                    <md-icon *ngIf="step.warning">warning</md-icon>
                </div>

                <div class="md-step-label">
                    <span class="md-step-title" [class.md-step-active]="selectedIndex == i || step.completed">
                        <template [portalHost]="step.label"></template>
                    </span>

                    <!--
                    <span class="md-step-optional">Editable: {{step.editable}}</span>
                    <br>
                    <span class="md-step-optional">Valid: {{step.valid}}</span>
                    <br>
                    <span class="md-step-optional">Completed: {{step.completed}}</span>
                    -->
                    <span *ngIf="step.optional" class="md-step-optional">Optional</span>
                    <span *ngIf="step.warning" class="md-step-optional">{{step.warningMessage}}</span>
                </div>
            </div>

            <!-- Wrapped in template to stop animation leaking into the horizontal mode when switched -->
            <template [ngIf]="orientation=='vertical'">
                <div class="md-step-content-wrapper" [@heightUpDown]="" *ngIf="selectedIndex == i">

                    <div class="md-step-body"
                         role="steppanel"
                         [id]="_getStepId('content', i)"
                         [class.md-step-active]="selectedIndex == i"
                         [attr.aria-labelledby]="_getStepId('label', i)">

                        <div class="md-step-transient-overlay" [@fadeInOut]="" *ngIf="selectedStep.saving">
                            <md-progress-circle class="md-step-progress" mode="indeterminate"></md-progress-circle>
                        </div>

                        <template [portalHost]="step.content"></template>

                    </div>
                    <div class="md-step-nav"
                         role="stepnav"
                         [id]="_getStepId('nav', i)"
                         [class.md-step-active]="selectedIndex == i">
                        <template [portalHost]="step.nav"></template>
                    </div>
                </div>
            </template>
            <!--
            <div class="md-step-nav-wrapper" *ngIf="orientation=='vertical' && selectedIndex == i">
                <div class="md-step-nav"
                     role="stepnav"
                     [id]="_getStepId('nav', i)"
                     [class.md-step-active]="selectedIndex == i">
                    <template [portalHost]="step.nav"></template>
                </div>
            </div>
            -->

        </div>

    </div>

    <template [ngIf]="orientation=='horizontal'">
        <template ngFor let-step [ngForOf]="_steps" let-i="index">
            <div class="md-step-content-wrapper"
                 role="steppanel"
                 [id]="_getStepId('content', i)"
                 [class.md-step-active]="selectedIndex == i"
                 [attr.aria-labelledby]="_getStepId('label', i)"
                 *ngIf="selectedIndex == i">
                <div class="md-step-transient-overlay" [@fadeInOut]="" *ngIf="selectedStep.saving">
                    <md-progress-circle class="md-step-progress" mode="indeterminate"></md-progress-circle>
                </div>
                <div class="md-step-body">
                        <template [portalHost]="step.content"></template>
                </div>
            </div>
        </template>

        <template ngFor let-step [ngForOf]="_steps" let-i="index">
            <div class="md-step-nav-wrapper"
                 role="stepnav"
                 [id]="_getStepId('nav', i)"
                 [class.md-step-active]="selectedIndex == i"
                 *ngIf="selectedIndex == i">
                <div class="md-step-nav">
                        <template [portalHost]="step.nav"></template>
                </div>
            </div>
        </template>
    </template>

</div>